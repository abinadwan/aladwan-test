<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>الوظائف - شركة العدوان</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 60px 0;
    }
    .jobs-card {
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      background-color: #ffffff;
      overflow: hidden;
    }
    .jobs-header {
      background: #1a3a6e;
      color: white;
      padding: 25px;
      text-align: center;
    }
    .form-control:focus {
      border-color: #1a3a6e;
      box-shadow: 0 0 0 0.2rem rgba(26, 58, 110, 0.25);
    }
    .btn-primary {
      background-color: #1a3a6e;
      border: none;
      padding: 10px 30px;
      font-size: 1.1rem;
    }
    .btn-primary:hover {
      background-color: #2c5282;
    }
    .email-preview {
      display: none;
      background-color: #f0f4f8;
      border: 1px solid #d0d8e8;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      font-family: monospace;
      line-height: 1.6;
    }
    .email-to,
    .email-subject,
    .email-body {
      margin: 10px 0;
      padding: 12px;
      background-color: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
    }
    .alert-danger {
      display: none;
      margin-top: 10px;
    }
    .lang-toggle {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
    }
  </style>
</head>
<body>

  <!-- زر تبديل اللغة -->
  <button class="btn btn-outline-dark lang-toggle" id="langToggle">English</button>

  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-9 col-lg-8">
        <div class="card jobs-card">
          <div class="card-header jobs-header">
            <h3 id="pageHeading">الوظائف المتاحة</h3>
            <p id="pageSubHeading">نرحب بالمواهب المؤهلة للانضمام إلى فريقنا</p>
          </div>

          <div class="card-body" id="formContainer">
            <form id="jobForm" novalidate>
              <!-- رسالة الخطأ للسبام -->
              <div class="alert alert-danger" id="spamError">
                <span id="spamMessage">يحتوي النموذج على محتوى غير مسموح به. يُرجى التحقق من المدخلات.</span>
              </div>

              <!-- عنوان الرسالة -->
              <div class="mb-3">
                <label for="subject" class="form-label" id="subjectLabel">عنوان الرسالة (20 حرفًا كحد أقصى)</label>
                <input type="text" class="form-control" id="subject" maxlength="20" required />
                <div class="form-text"><span id="charCountText">عدد الأحرف</span>: <span id="charCount">0</span>/20</div>
              </div>

              <!-- الاسم الكامل -->
              <div class="mb-3">
                <label for="fullName" class="form-label" id="fullNameLabel">الاسم الكامل</label>
                <input type="text" class="form-control" id="fullName" required />
              </div>

              <!-- البريد الإلكتروني -->
              <div class="mb-3">
                <label for="email" class="form-label" id="emailLabel">البريد الإلكتروني</label>
                <input type="email" class="form-control" id="email" required />
              </div>

              <!-- رقم التواصل -->
              <div class="mb-3">
                <label for="phone" class="form-label" id="phoneLabel">رقم التواصل</label>
                <input type="tel" class="form-control" id="phone" placeholder="+966 XXX XXX XXXX" required />
              </div>

              <!-- قسم معلومات الوظيفة -->
              <div class="mb-4 p-3 bg-light rounded" style="border: 1px dashed #1a3a6e;">
                <h5 id="jobSectionTitle">معلومات الوظيفة</h5>

                <!-- المسمى الوظيفي المطلوب -->
                <div class="mb-3">
                  <label for="jobTitle" class="form-label" id="jobTitleLabel">المسمى الوظيفي المطلوب</label>
                  <input type="text" class="form-control" id="jobTitle" required />
                </div>

                <!-- رفع السيرة الذاتية -->
                <div class="mb-3">
                  <label for="cvUpload" class="form-label" id="cvUploadLabel">رفع السيرة الذاتية (CV)</label>
                  <input type="file" class="form-control" id="cvUpload" accept=".pdf,.doc,.docx" required />
                  <div class="form-text" id="fileHelpText">الملفات المسموحة: PDF, DOC, DOCX - الحد الأقصى: 5 ميجابايت</div>
                </div>
              </div>

              <div class="d-grid">
                <button type="submit" class="btn btn-primary" id="submitBtn">إرسال الطلب</button>
              </div>
            </form>
          </div>

          <!-- عرض البريد بعد الإرسال -->
          <div class="card-body email-preview" id="emailPreview">
            <h5 id="emailTitle">تم إرسال طلبك بنجاح</h5>
            <p id="emailDesc">تم إرسال طلبك كبريد إلكتروني إلى:</p>

            <div class="email-to">
              <strong id="toLabel">إلى:</strong> <span>career@aladwan.sa</span>
            </div>

            <div class="email-subject">
              <strong id="subjectLabelEmail">الموضوع:</strong> <span id="displaySubject">-</span>
            </div>

            <div class="email-body">
              <strong id="bodyLabel">تفاصيل الطلب:</strong><br>
              <span id="emailBody"></span>
            </div>

            <div class="mt-3">
              <button class="btn btn-outline-secondary btn-sm" id="backBtn">
                العودة إلى النموذج
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const translations = {
      ar: {
        pageHeading: "الوظائف المتاحة",
        pageSubHeading: "نرحب بالمواهب المؤهلة للانضمام إلى فريقنا",
        subjectLabel: "عنوان الرسالة (20 حرفًا كحد أقصى)",
        fullNameLabel: "الاسم الكامل",
        emailLabel: "البريد الإلكتروني",
        phoneLabel: "رقم التواصل",
        jobSectionTitle: "معلومات الوظيفة",
        jobTitleLabel: "المسمى الوظيفي المطلوب",
        cvUploadLabel: "رفع السيرة الذاتية (CV)",
        fileHelpText: "الملفات المسموحة: PDF, DOC, DOCX - الحد الأقصى: 5 ميجابايت",
        charCountText: "عدد الأحرف",
        submitBtn: "إرسال الطلب",
        emailTitle: "تم إرسال طلبك بنجاح",
        emailDesc: "تم إرسال طلبك كبريد إلكتروني إلى:",
        toLabel: "إلى:",
        subjectLabelEmail: "الموضوع:",
        bodyLabel: "تفاصيل الطلب:",
        backBtn: "العودة إلى النموذج",
        spamMessage: "يحتوي النموذج على محتوى غير مسموح به. يُرجى التحقق من المدخلات.",
        invalidName: "الاسم لا يجب أن يحتوي على أرقام أو رموز.",
        invalidJobTitle: "المسمى الوظيفي لا يجب أن يحتوي على روابط أو كلمات دعائية.",
        suspiciousContent: "تم اكتشاف محتوى مشبوه (روابط، تعليمات برمجية)."
      },
      en: {
        pageHeading: "Available Jobs",
        pageSubHeading: "We welcome qualified talents to join our team",
        subjectLabel: "Subject (max 20 characters)",
        fullNameLabel: "Full Name",
        emailLabel: "Email Address",
        phoneLabel: "Phone Number",
        jobSectionTitle: "Job Information",
        jobTitleLabel: "Desired Job Title",
        cvUploadLabel: "Upload CV",
        fileHelpText: "Allowed files: PDF, DOC, DOCX - Max 5 MB",
        charCountText: "Characters",
        submitBtn: "Submit Application",
        emailTitle: "Your application has been sent successfully",
        emailDesc: "Your application has been sent as an email to:",
        toLabel: "To:",
        subjectLabelEmail: "Subject:",
        bodyLabel: "Application Details:",
        backBtn: "Back to Form",
        spamMessage: "The form contains prohibited content. Please review your inputs.",
        invalidName: "Name should not contain numbers or special symbols.",
        invalidJobTitle: "Job title should not contain links or promotional text.",
        suspiciousContent: "Suspicious content detected (links, scripts)."
      }
    };

    let currentLang = 'ar';

    // تبديل اللغة
    document.getElementById('langToggle').addEventListener('click', function () {
      currentLang = currentLang === 'ar' ? 'en' : 'ar';
      this.textContent = currentLang === 'ar' ? 'English' : 'العربية';
      document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
      document.documentElement.lang = currentLang;

      Object.keys(translations.ar).forEach(key => {
        const element = document.getElementById(key);
        if (element) element.textContent = translations[currentLang][key];
      });

      document.getElementById('phone').placeholder = currentLang === 'ar' ? '+966 XXX XXX XXXX' : '+966 XXX XXX XXXX';
    });

    // عداد الأحرف
    document.getElementById("subject").addEventListener("input", function () {
      document.getElementById("charCount").textContent = this.value.length;
    });

    // قائمة الكلمات والأنماط المشبوهة
    const blockedPatterns = [
      /http/gi,
      /www\./gi,
      /<script/gi,
      /<\/script>/gi,
      /<.*?>/g, // أي علامة HTML
      /viagra|porn|loan|money|click here|best deal/gi, // كلمات دعائية شائعة
    ];

    const validateSpam = (text, fieldName = '') => {
      for (let pattern of blockedPatterns) {
        if (pattern.test(text)) {
          return false;
        }
      }

      // التحقق من أن الاسم لا يحتوي على أرقام أو رموز
      if (fieldName === 'name') {
        if (/[0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(text)) {
          return 'name-invalid';
        }
      }

      // التحقق من المسمى الوظيفي
      if (fieldName === 'jobTitle') {
        if (/[0-9]{5,}/.test(text) || text.length > 100) {
          return 'jobTitle-invalid';
        }
      }

      return true;
    };

    // معالجة الإرسال
    document.getElementById("jobForm").addEventListener("submit", function (e) {
      e.preventDefault();
      document.getElementById("spamError").style.display = "none";

      // جمع البيانات
      const subject = document.getElementById("subject").value.trim();
      const fullName = document.getElementById("fullName").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const jobTitle = document.getElementById("jobTitle").value.trim();
      const cvFile = document.getElementById("cvUpload").files[0];

      // التحقق من الحقول المطلوبة
      if (!subject || !fullName || !email || !phone || !jobTitle || !cvFile) {
        alert(currentLang === 'ar' ? 'يرجى تعبئة جميع الحقول.' : 'Please fill all fields.');
        return;
      }

      // التحقق من السبام
      let spamReason = null;

      if (!validateSpam(fullName, 'name')) {
        spamReason = translations[currentLang].invalidName;
      } else if (!validateSpam(jobTitle, 'jobTitle')) {
        spamReason = translations[currentLang].invalidJobTitle;
      } else if (!validateSpam(subject) || !validateSpam(email) || !validateSpam(phone)) {
        spamReason = translations[currentLang].suspiciousContent;
      }

      if (spamReason) {
        const errorDiv = document.getElementById("spamError");
        errorDiv.querySelector('#spamMessage').textContent = spamReason;
        errorDiv.style.display = "block";
        return;
      }

      // نجاح الإرسال - إخفاء النموذج وعرض البريد
      document.getElementById("formContainer").style.display = "none";
      document.getElementById("emailPreview").style.display = "block";

      document.getElementById("displaySubject").textContent = subject;

      const body = `
        <strong>${currentLang === 'ar' ? 'الاسم الكامل' : 'Full Name'}:</strong> ${fullName}<br>
        <strong>${currentLang === 'ar' ? 'البريد الإلكتروني' : 'Email'}:</strong> ${email}<br>
        <strong>${currentLang === 'ar' ? 'رقم التواصل' : 'Phone'}:</strong> ${phone}<br>
        <strong>${currentLang === 'ar' ? 'المسمى الوظيفي' : 'Job Title'}:</strong> ${jobTitle}<br>
        <strong>${currentLang === 'ar' ? 'اسم الملف المرفق' : 'Attached File'}:</strong> ${cvFile.name}
      `;
      document.getElementById("emailBody").innerHTML = body;

      // تحديث الترجمات
      Object.keys(translations.ar).forEach(key => {
        const element = document.getElementById(key);
        if (element) element.textContent = translations[currentLang][key];
      });
    });

    // العودة إلى النموذج
    document.getElementById("backBtn").addEventListener("click", function () {
      document.getElementById("emailPreview").style.display = "none";
      document.getElementById("formContainer").style.display = "block";
      document.getElementById("jobForm").reset();
      document.getElementById("charCount").textContent = "0";
      document.getElementById("spamError").style.display = "none";
    });
  </script>
</body>
</html>
